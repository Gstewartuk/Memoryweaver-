From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: you <you@example.com>
Date: Tue, 23 Dec 2025 00:00:00 +0000
Subject: [PATCH] chore(ui): wrap page with container & card, add styles

---
 app/pages/index.tsx | 252 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 app/styles.css      | 217 ++++++++++++++++++++++++++++++++++++++++++++++++++
 pages/_app.tsx      |   8 +++
 3 files changed, 477 insertions(+)
 create mode 100644 app/pages/index.tsx
 create mode 100644 app/styles.css
 create mode 100644 pages/_app.tsx
+++ b/app/pages/index.tsx
+import React, { useEffect, useState } from "react";
+import { createClient } from "@supabase/supabase-js";
+import axios from "axios";
+import Auth from "../components/Auth";
+
+const supabase = createClient(
+  process.env.NEXT_PUBLIC_SUPABASE_URL ?? "",
+  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY ?? ""
+);
+
+type Child = { id: number; name: string } | null;
+type Memory = { id: number; note?: string; image_path?: string; taken_at?: string };
+
+export default function Home({ session }: any) {
+  const [children, setChildren] = useState<Child[]>([]);
+  const [selectedChild, setSelectedChild] = useState<number | null>(null);
+  const [memories, setMemories] = useState<Memory[]>([]);
+  const [note, setNote] = useState("");
+  const [file, setFile] = useState<File | null>(null);
+  const [theme, setTheme] = useState<string>("classic");
+
+  // Load children (only read; create default only if authenticated)
+  useEffect(() => {
+    async function loadChildren() {
+      try {
+        const { data, error } = await supabase.from("children").select("*").limit(50);
+        if (error) {
+          console.error("Error loading children:", error);
+          setChildren([]);
+          setSelectedChild(null);
+          return;
+        }
+
+        if (!data || data.length === 0) {
+          // If user is signed in, create an initial child for convenience.
+          const user = session?.user;
+          if (user) {
+            const insertResp = await supabase
+              .from("children")
+              .insert([{ name: "Ava", user_id: user.id }])
+              .select()
+              .single();
+
+            if (insertResp.error) {
+              console.error("Insert child failed:", insertResp.error);
+              setChildren([]);
+              setSelectedChild(null);
+              return;
+            }
+
+            if (insertResp.data) {
+              setChildren([insertResp.data as Child]);
+              setSelectedChild((insertResp.data as any).id ?? null);
+            } else {
+              setChildren([]);
+              setSelectedChild(null);
+            }
+          } else {
+            // Not signed in: show empty list and prompt to sign in to add children
+            setChildren([]);
+            setSelectedChild(null);
+          }
+        } else {
+          setChildren(data as Child[]);
+          setSelectedChild((data[0] as any)?.id ?? null);
+        }
+      } catch (err) {
+        console.error("Unexpected error loading children:", err);
+        setChildren([]);
+        setSelectedChild(null);
+      }
+    }
+    loadChildren();
+  }, [session]);
+
+  // Load memories only when a valid child is selected
+  useEffect(() => {
+    if (!selectedChild) {
+      setMemories([]);
+      return;
+    }
+    async function loadMemories() {
+      try {
+        const { data, error } = await supabase
+          .from("memories")
+          .select("*")
+          .eq("child_id", selectedChild)
+          .order("taken_at", { ascending: true });
+
+        if (error) {
+          console.error("Error loading memories:", error);
+          setMemories([]);
+          return;
+        }
+        setMemories((data as Memory[]) || []);
+      } catch (err) {
+        console.error("Failed to load memories:", err);
+        setMemories([]);
+      }
+    }
+    loadMemories();
+  }, [selectedChild]);
+
+  async function uploadMemory(e: React.FormEvent) {
+    e.preventDefault();
+    if (!selectedChild) return alert("Select a child");
+    const currentSession = (await supabase.auth.getSession()).data.session;
+    if (!currentSession) return alert("Sign in first.");
+
+    let imagePath: string | null = null;
+
+    if (file) {
+      const filePath = `${selectedChild}/${Date.now()}-${file.name}`;
+      const { error } = await supabase.storage.from("memories").upload(filePath, file, { upsert: false });
+      if (error) {
+        alert("Upload failed: " + error.message);
+        return;
+      }
+      const publicUrl = supabase.storage.from("memories").getPublicUrl(filePath).data.publicUrl;
+      imagePath = publicUrl;
+    }
+
+    try {
+      await axios.post(
+        "/api/memories",
+        { childId: selectedChild, note, imagePath, takenAt: new Date().toISOString() },
+        { headers: { Authorization: `Bearer ${currentSession.access_token}` } }
+      );
+    } catch (err: any) {
+      console.error("Save memory failed:", err);
+      alert("Save failed; check console.");
+      return;
+    }
+
+    setNote("");
+    setFile(null);
+
+    try {
+      const { data } = await supabase.from("memories").select("*").eq("child_id", selectedChild).order("taken_at", { ascending: true });
+      setMemories((data as Memory[]) || []);
+    } catch (err) {
+      console.error("Failed to reload memories:", err);
+    }
+  }
+
+  return (
+    <div className="container">
+      <div className="card">
+        <div className="header">
+          <div className="brand">
+            <div className="logo">M</div>
+            <div className="title">Memory Weaver</div>
+          </div>
+          <Auth />
+        </div>
+
+        <div className="grid">
+          <main>
+            <div className="child-select">
+              <label className="small">Child</label>
+              <select
+                value={selectedChild ?? ""}
+                onChange={(e) => setSelectedChild(Number(e.target.value) || null)}
+              >
+                <option value="">— select —</option>
+                {children
+                  .filter(Boolean)
+                  .map((c) => (
+                    <option key={(c as any).id} value={(c as any).id}>
+                      {(c as any).name}
+                    </option>
+                  ))}
+              </select>
+            </div>
+
+            <form onSubmit={uploadMemory} className="controls">
+              <label className="small">Note</label>
+              <input
+                type="text"
+                placeholder="A short note"
+                value={note}
+                onChange={(e) => setNote(e.target.value)}
+              />
+
+              <label className="small">Image</label>
+              <input type="file" accept="image/*" onChange={(e) => setFile(e.target.files?.[0] ?? null)} />
+
+              <div>
+                <button className="btn" type="submit">Save Memory</button>
+              </div>
+            </form>
+
+            <section style={{ marginTop: 24 }}>
+              <h2>Memories</h2>
+              {memories.length === 0 && <p className="small">No memories yet.</p>}
+              <ul className="memories-list">
+                {memories.map((m) => (
+                  <li key={(m as any).id}>
+                    <div style={{ flex: 1 }}>
+                      <div>{(m as any).note}</div>
+                      <div className="small">{(m as any).taken_at}</div>
+                    </div>
+                    {(m as any).image_path && <img src={(m as any).image_path} alt="memory" />}
+                  </li>
+                ))}
+              </ul>
+            </section>
+          </main>
+
+          <aside>
+            <div style={{ marginBottom: 12 }}>
+              <label className="small">Theme</label>
+              <select value={theme} onChange={(e) => setTheme(e.target.value)}>
+                <option value="classic">Classic</option>
+                <option value="fairy">Fairy Tale</option>
+                <option value="adventure">Adventure</option>
+              </select>
+            </div>
+
+            <div className="footer-controls">
+              <button
+                className="btn"
+                onClick={async () => {
+                  if (!selectedChild) return alert("Select a child");
+                  const currentSession = (await supabase.auth.getSession()).data.session;
+                  if (!currentSession) return alert("Sign in first.");
+                  try {
+                    const res = await axios.post(
+                      `/api/generate?childId=${selectedChild}&interval=monthly&pdf=true&theme=${theme}`,
+                      {},
+                      { headers: { Authorization: `Bearer ${currentSession.access_token}` } }
+                    );
+                    if (res.data?.pdfUrl) {
+                      window.open(res.data.pdfUrl, "_blank");
+                    } else {
+                      const w = window.open();
+                      w?.document.write(res.data.storyHtml);
+                      w?.document.close();
+                    }
+                  } catch (err: any) {
+                    alert("Generate failed; check console");
+                    console.error(err);
+                  }
+                }}
+              >
+                Generate & Download PDF
+              </button>
+
+              <button
+                className="btn secondary"
+                onClick={() => {
+                  setNote("");
+                  setFile(null);
+                }}
+              >
+                Clear
+              </button>
+            </div>
+          </aside>
+        </div>
+      </div>
+    </div>
+  );
+}
+
+++ b/app/styles.css
+/* Quick visual refresh for Memory Weaver - drop into app/styles.css */
+
+/* Base */
+:root{
+  --bg: #f7f7fa;
+  --card: #ffffff;
+  --muted: #6b7280;
+  --accent: #6f46c9;
+  --accent-2: #5b21b6;
+  --shadow: rgba(15, 23, 42, 0.06);
+  --max-width: 980px;
+}
+
+* { box-sizing: border-box; }
+html, body, #__next { height: 100%; }
+body {
+  margin: 0;
+  font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
+  background: linear-gradient(180deg, #ffffff 0%, var(--bg) 100%);
+  color: #0f172a;
+  -webkit-font-smoothing: antialiased;
+}
+
+/* Page container */
+.container {
+  max-width: var(--max-width);
+  margin: 40px auto;
+  padding: 20px;
+}
+
+/* Card surface */
+.card {
+  background: var(--card);
+  border-radius: 12px;
+  padding: 20px;
+  box-shadow: 0 10px 30px var(--shadow);
+  border: 1px solid rgba(0,0,0,0.03);
+}
+
+/* Header */
+.header {
+  display: flex;
+  align-items: center;
+  justify-content: space-between;
+  gap: 12px;
+}
+.brand {
+  display:flex;
+  align-items:center;
+  gap:12px;
+}
+.brand .logo {
+  width:42px;
+  height:42px;
+  border-radius:8px;
+  background: linear-gradient(135deg,var(--accent),var(--accent-2));
+  display:flex;
+  align-items:center;
+  justify-content:center;
+  color:#fff;
+  font-weight:700;
+  box-shadow: 0 6px 18px rgba(106, 90, 204, 0.12);
+}
+.brand .title {
+  font-size:18px;
+  font-weight:700;
+}
+
+/* Layout grid */
+.grid {
+  display: grid;
+  grid-template-columns: 1fr 360px;
+  gap: 20px;
+  margin-top: 20px;
+}
+
+/* For narrower screens */
+@media (max-width: 880px) {
+  .grid { grid-template-columns: 1fr; }
+}
+
+/* Form and controls */
+.controls {
+  display:flex;
+  flex-direction:column;
+  gap:8px;
+}
+input[type="text"], input[type="file"], select, textarea {
+  width:100%;
+  padding:10px 12px;
+  border-radius:8px;
+  border: 1px solid rgba(15,23,42,0.06);
+  background:#fff;
+}
+.btn {
+  display:inline-block;
+  background: linear-gradient(180deg,var(--accent),var(--accent-2));
+  color:#fff;
+  border:none;
+  padding:10px 14px;
+  border-radius:8px;
+  cursor:pointer;
+  font-weight:600;
+}
+.btn.secondary {
+  background:transparent;
+  border:1px solid rgba(15,23,42,0.06);
+  color:var(--muted);
+}
+
+/* Memories list */
+.memories-list { list-style:none; padding:0; margin:0; }
+.memories-list li {
+  display:flex;
+  gap:12px;
+  padding:12px;
+  border-radius:8px;
+  align-items:flex-start;
+  background: #fff;
+  border:1px solid rgba(15,23,42,0.03);
+}
+.memories-list img {
+  width:140px;
+  height:auto;
+  object-fit:cover;
+  border-radius:8px;
+}
+
+/* Child select box */
+.child-select { margin-bottom: 12px; }
+
+/* Small helper text */
+.small { font-size:13px; color:var(--muted); }
+
+/* Footer controls */
+.footer-controls { display:flex; gap:8px; align-items:center; }
+
+/* Minor helpers */
+.center { text-align:center; }
+
+++ b/pages/_app.tsx
+import "../styles.css";
+import type { AppProps } from "next/app";
+
+export default function App({ Component, pageProps }: AppProps) {
+  return <Component {...pageProps} />;
+}
+
-- 
2.34.1
